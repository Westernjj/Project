{% extends "shop/layout.html" %}
{% block title %}Реєстрація{% endblock %}

{% block extra_css %}
<style>
  .field { margin-bottom: 16px; }
  .password-input {
    position: relative;
    display: inline-block;
    width: 100%;
    max-width: 320px;
  }
  .password-input input {
    width: 100%;
    padding-right: 38px; /* місце під кнопку */
  }
  .toggle-password {
    position: absolute;
    right: 8px;
    top: 50%;
    transform: translateY(-50%);
    border: none;
    background: transparent;
    padding: 4px;
    cursor: pointer;
  }
  .toggle-password:focus { outline: 2px solid #2684ff; outline-offset: 2px; }
  .toggle-password svg { width: 22px; height: 22px; }
</style>
{% endblock %}

{% block content %}
<h2>Реєстрація</h2>

<form method="post" novalidate>
  {% csrf_token %}

  <div class="field">
    {{ form.username.label_tag }}<br>
    {{ form.username }}
    {{ form.username.errors }}
  </div>

  <div class="field">
    {{ form.email.label_tag }}<br>
    {{ form.email }}
    {{ form.email.errors }}
  </div>

  <div class="field">
    {{ form.password1.label_tag }}<br>
    <div class="password-input">
      {{ form.password1 }}
      <button
        type="button"
        class="toggle-password"
        data-target="id_password1"
        aria-label="Показати пароль"
        title="Показати пароль"
      >
        <!-- іконка «око» -->
        <svg viewBox="0 0 24 24" aria-hidden="true">
          <path d="M12 5c-5 0-9 5-9 7s4 7 9 7 9-5 9-7-4-7-9-7zm0 12a5 5 0 1 1 0-10 5 5 0 0 1 0 10z"/>
        </svg>
      </button>
    </div>
    {{ form.password1.help_text }}
    {{ form.password1.errors }}
  </div>

  <div class="field">
    {{ form.password2.label_tag }}<br>
    <div class="password-input">
      {{ form.password2 }}
      <button
        type="button"
        class="toggle-password"
        data-target="id_password2"
        aria-label="Показати пароль"
        title="Показати пароль"
      >
        <svg viewBox="0 0 24 24" aria-hidden="true">
          <path d="M12 5c-5 0-9 5-9 7s4 7 9 7 9-5 9-7-4-7-9-7zm0 12a5 5 0 1 1 0-10 5 5 0 0 1 0 10z"/>
        </svg>
      </button>
    </div>
    {{ form.password2.errors }}
  </div>

  <button type="submit">Створити акаунт</button>
</form>
{% endblock %}

{% block extra_js %}
<script>
  (function () {
    function setIcon(btn, visible) {
      btn.title = visible ? 'Приховати пароль' : 'Показати пароль';
      btn.setAttribute('aria-label', btn.title);
      // міняємо іконку: око ↔ перекреслене око
      btn.innerHTML = visible
        ? '<svg viewBox="0 0 24 24" aria-hidden="true"><path d="M2 12s4-7 10-7c1.6 0 3 .4 4.3 1.1l-1.6 1.6A7.2 7.2 0 0 0 12 7C7.6 7 4.2 10.9 3.2 12c.3.4 1 .9 1.8 1.6l-1.4 1.4C2.8 14.2 2 13.1 2 12zm20 0c0 .9-.8 2.2-1.6 3L20 16c.8-.7 1.5-1.2 1.8-1.6-.8-1-4.2-5-8.6-5-.7 0-1.5.1-2.1.3l1.6-1.6C13 7.4 14.4 7 16 7c6 0 10 7 10 7zM4.4 20.5 3 19.1 19.1 3l1.4 1.4L4.4 20.5z"/></svg>'
        : '<svg viewBox="0 0 24 24" aria-hidden="true"><path d="M12 5c-5 0-9 5-9 7s4 7 9 7 9-5 9-7-4-7-9-7zm0 12a5 5 0 1 1 0-10 5 5 0 0 1 0 10z"/></svg>';
    }

    document.querySelectorAll('.toggle-password').forEach(function (btn) {
      var input = document.getElementById(btn.dataset.target);
      if (!input) return;

      setIcon(btn, false);

      btn.addEventListener('click', function () {
        var visible = input.type === 'password';
        input.type = visible ? 'text' : 'password';
        setIcon(btn, visible);
        input.focus();
      });
    });
  })();
</script>
{% endblock %}
